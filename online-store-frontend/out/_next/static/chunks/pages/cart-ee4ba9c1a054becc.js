(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[442],{8834:(e,t,a)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/cart",function(){return a(3954)}])},3954:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>i});var l=a(4848),s=a(2992),n=a(6540),r=a(6715),c=a(9965),d=a.n(c);function i(){let{cart:e,updateQuantity:t,removeFromCart:a,clearCart:c}=(0,s._)(),i=(0,r.useRouter)(),[o,u]=(0,n.useState)(""),[x,h]=(0,n.useState)(""),[m,p]=(0,n.useState)(""),[b,g]=(0,n.useState)(""),[j,N]=(0,n.useState)(""),[v,w]=(0,n.useState)(!1),[f,y]=(0,n.useState)(!1),D=(0,n.useRef)(null),C=e.reduce((e,t)=>e+t.price*t.quantity,0),k=async()=>{if(!o||!x||!m){g("❌ กรุณากรอกข้อมูลให้ครบ");return}g(""),D.current&&(clearInterval(D.current),D.current=null),N(""),w(!1),y(!1),await _()},_=async()=>{var e,t,a;let l=await fetch("".concat("https://systemappbackend-production.up.railway.app","/api/create"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({amount:100*C})}),s=await l.json(),n=null==s?void 0:null===(a=s.source)||void 0===a?void 0:null===(t=a.scannable_code)||void 0===t?void 0:null===(e=t.image)||void 0===e?void 0:e.download_uri,r=null==s?void 0:s.id;if(!n||!r){alert("❌ ไม่สามารถสร้าง QR Code ได้");return}N(n),w(!0),S(r)},S=t=>{let a=0,l=1e4,s=async()=>{let n=await fetch("".concat("https://systemappbackend-production.up.railway.app","/api/status/").concat(t));(await n.json()).paid?(clearInterval(D.current),D.current=null,w(!1),y(!0),(await fetch("".concat("https://systemappbackend-production.up.railway.app","/api/order"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:o,address:x,phone:m,cart:e,totalPrice:C})})).ok?(alert("✅ ชำระเงินและส่งอีเมลสำเร็จ!"),c(),u(""),h(""),p(""),N(""),y(!1),i.push("https://organeh.com")):(alert("⚠️ ชำระสำเร็จ แต่ส่งอีเมลไม่สำเร็จ"),y(!1))):3==++a&&(clearInterval(D.current),l=3e4,D.current=setInterval(s,l))};D.current=setInterval(s,l),setTimeout(()=>{D.current&&clearInterval(D.current)},3e5)};return(0,l.jsxs)("div",{className:"p-10 max-w-lg mx-auto bg-gray-100 rounded-lg shadow-lg relative",children:[f&&(0,l.jsx)("div",{className:"absolute inset-0 bg-white bg-opacity-80 flex flex-col items-center justify-center z-50",children:(0,l.jsx)("div",{className:"text-xl text-blue-600 font-bold",children:"⏳ กำลังทำรายการ กรุณารอสักครู่..."})}),(0,l.jsx)("button",{className:"mb-5 px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-700 flex items-center",onClick:()=>i.back(),children:"⬅️ ย้อนกลับ"}),(0,l.jsx)("h2",{className:"text-3xl font-bold mb-5 text-center",children:"\uD83D\uDED2 ตะกร้าสินค้าของคุณ"}),0===e.length?(0,l.jsx)("p",{className:"text-red-500 text-lg text-center",children:"❌ ตะกร้าสินค้าว่าง"}):(0,l.jsx)("div",{className:"space-y-4",children:e.map(e=>(0,l.jsxs)("div",{className:"border rounded-lg shadow p-4 flex items-center gap-4 bg-white",children:[(0,l.jsx)(d(),{src:e.image.startsWith("http")?e.image:"https://organeh.com/shop".concat(e.image),alt:e.name,width:96,height:96,className:"object-cover rounded"}),(0,l.jsxs)("div",{className:"flex-grow",children:[(0,l.jsx)("h2",{className:"text-lg font-semibold",children:e.name}),(0,l.jsxs)("p",{className:"text-lg font-bold text-blue-500",children:[e.price,"฿"]}),(0,l.jsxs)("div",{className:"flex items-center gap-2 mt-2",children:[(0,l.jsx)("button",{className:"bg-gray-300 px-3 py-1 rounded text-lg",onClick:()=>t(e.id,e.quantity-1),children:"➖"}),(0,l.jsx)("span",{className:"text-lg",children:e.quantity}),(0,l.jsx)("button",{className:"bg-gray-300 px-3 py-1 rounded text-lg",onClick:()=>t(e.id,e.quantity+1),children:"➕"})]})]}),(0,l.jsx)("button",{className:"bg-red-500 text-white px-3 py-2 rounded hover:bg-red-700 flex items-center",onClick:()=>a(e.id),children:"\uD83D\uDDD1 ลบ"})]},e.id))}),e.length>0&&(0,l.jsxs)("h2",{className:"text-2xl font-bold text-green-500 mt-5 text-center",children:["\uD83D\uDCB0 ราคารวมทั้งหมด: ",C,"฿"]}),(0,l.jsxs)("div",{className:"mt-5 bg-white p-5 rounded-lg shadow-lg",children:[(0,l.jsx)("label",{className:"block text-lg font-bold",children:"\uD83D\uDC64 ชื่อ :"}),(0,l.jsx)("input",{type:"text",value:o,onChange:e=>u(e.target.value),className:"w-full border p-2 rounded mt-1"}),(0,l.jsx)("label",{className:"block text-lg font-bold mt-3",children:"\uD83D\uDCCD ที่อยู่ :"}),(0,l.jsx)("textarea",{value:x,onChange:e=>h(e.target.value),className:"w-full border p-2 rounded mt-1",rows:"3"}),(0,l.jsx)("label",{className:"block text-lg font-bold mt-3",children:"\uD83D\uDCDE เบอร์โทร :"}),(0,l.jsx)("input",{type:"tel",value:m,onChange:e=>p(e.target.value),className:"w-full border p-2 rounded mt-1"}),b&&(0,l.jsx)("p",{className:"text-red-500 mt-3",children:b}),(0,l.jsx)("button",{className:"mt-4 bg-blue-500 text-white px-6 py-2 rounded hover:bg-blue-700 w-full text-lg",onClick:k,disabled:0===e.length,children:"\uD83D\uDECD สั่งซื้อสินค้า"})]}),v&&(0,l.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-60 flex justify-center items-center z-50",children:(0,l.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-lg text-center max-w-sm",children:[(0,l.jsx)("h2",{className:"text-xl font-bold mb-4",children:"\uD83D\uDCF2 สแกนเพื่อชำระเงิน"}),(0,l.jsx)("img",{src:j,alt:"PromptPay QR Code",className:"mx-auto mb-4 w-60"}),(0,l.jsx)("p",{className:"text-blue-500",children:"⏳ กรุณาชำระเงินภายในระยะเวลา 5 นาที"}),(0,l.jsx)("button",{onClick:()=>w(!1),className:"mt-4 px-4 py-2 bg-red-500 text-white rounded hover:bg-red-700",children:"❌ ปิด"})]})})]})}}},e=>{var t=t=>e(e.s=t);e.O(0,[615,636,593,792],()=>t(8834)),_N_E=e.O()}]);